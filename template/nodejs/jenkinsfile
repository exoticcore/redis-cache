pipeline {
    environment {
        registry = ""
        registryCredential = ""
        dockerImage = ''
    }
    agent any

    stages {
        stage('Unit Test') {
            steps {
                echo 'Running Unit Test'
            }
        }
        stage('Integration Test') {
            steps {
                echo 'Running Integration Test'
            }
        }
        stage('End to End Test') {
            steps {
                echo 'Running End to End Test'
            }
        }
        stage('SonarQube Analysis') {
            steps {
                echo 'Running SonarQube Analysis'
            }
        }
         stage('Build Artifact') {
            steps {
                script {
                    dir('template/nodejs') {
                        dockerImage = docker.build("${registry}:${BUILD_NUMBER}", "-f Dockerfile .")
                    }
                }
            }
        }
       stage('Push Docker Image') {
            steps {
                script {
                    docker.withRegistry('https://us-docker.pkg.dev', registryCredential) {
                        dockerImage.push()
                        dockerImage.push('latest')
                    }
                }
            }
        }
    }
}